import os
import random
import time

from whiplash.api.client import Whiplash
from whiplash.api.client.vector import Vector

API_KEY = os.environ.get("WHIPLASH_API_KEY", "")
API_URL = os.environ.get("WHIPLASH_API_URL", "")

query = [
    0.5472027109444431,
    0.897580752165919,
    0.05493124081150591,
    0.9455705605132989,
    0.1830524715827493,
    0.27658407050422107,
    0.03134376745855172,
    0.18014361022653003,
    0.05045686837200669,
    0.2966652841656209,
    0.19063081752859856,
    0.30323746750902303,
    0.3935838023655389,
    0.6736084524389261,
    0.6362285324060147,
    0.6105560472881069,
    0.41841582781129005,
    0.7120026449691897,
    0.5211012524206822,
    0.5586004685386197,
    0.9758909592984528,
    0.03435336817971124,
    0.41417770542179455,
    0.12126697656024288,
    0.747441751303401,
    0.1650966811532424,
    0.7887860282149584,
    0.39732494427797527,
    0.15656476587656643,
    0.10262727143708394,
    0.37105690404121694,
    0.46817463303022877,
    0.35373973274880044,
    0.637628379444055,
    0.5819652913548518,
    0.3506775997794156,
    0.2601607310882659,
    0.30793392723720947,
    0.12580299828280994,
    0.8219526898158183,
    0.3760611101760333,
    0.36113139889503676,
    0.35150744835425185,
    0.6434907550735043,
    0.47119189265024697,
    0.15748578075135955,
    0.35057423815878397,
    0.9809820082538181,
    0.440644449963963,
    0.26665921687593797,
    0.31018774440946806,
    0.09122372459837336,
    0.2535000283711575,
    0.7265254817392148,
    0.7517753722514202,
    0.0009854544863404646,
    0.07968884297737056,
    0.17929446118571923,
    0.303115505136217,
    0.807335689652021,
    0.48671915366100993,
    0.9234927181608958,
    0.44318235499664316,
    0.9795076031572044,
    0.5097527806233717,
    0.3472290824610479,
    0.805959286842352,
    0.9724084580232524,
    0.060523935474281365,
    0.37499937942790074,
    0.20218472670324794,
    0.8264763380700236,
    0.20919311511843763,
    0.4478176777107752,
    0.38405191370153036,
    0.5127755139813893,
    0.18128455987764258,
    0.617174887132555,
    0.49894635007963073,
    0.5784316248599629,
    0.998626894856415,
    0.7142236227189654,
    0.5542588963927876,
    0.20315690777890705,
    0.6328078839647673,
    0.24787322162625824,
    0.061322858170471006,
    0.19803479992702078,
    0.07851266060067386,
    0.18099968970822844,
    0.143226269166294,
    0.8461050687318618,
    0.287420464087897,
    0.6253987235401355,
    0.7760287807971398,
    0.8359955450734889,
    0.3278178257805001,
    0.5918628308332166,
    0.49576052043696817,
    0.7675185424946942,
    0.20401790879127002,
    0.9282864430091503,
    0.004622171750923609,
    0.33172424600545936,
    0.8212701382788358,
    0.9825813044681608,
    0.9668598153538277,
    0.8231357880594897,
    0.7853585637766012,
    0.34903389598047907,
    0.23631087439628962,
    0.0581649953769775,
    0.9455327518103793,
    0.8456179797702491,
    0.4899502329284693,
    0.355096078531814,
    0.7025339262520373,
    0.3519283120141482,
    0.2278916209409746,
    0.2522330510609413,
    0.18482714421810653,
    0.15724628867756407,
    0.6145002109255944,
    0.21875356675769753,
    0.07622457908389157,
    0.844874527017468,
    0.39368482404214467,
    0.29729794516493124,
    0.9998946287796938,
    0.11235512659900126,
    0.2589222476945946,
    0.9346309224580125,
    0.297900623264731,
    0.38010642875636225,
    0.40853480134795894,
    0.09317009519994268,
    0.5579280082793615,
    0.6277917673929062,
    0.7586762368147751,
    0.2491647878512856,
    0.3641212039490541,
    0.26721038439014133,
    0.36387834255968543,
    0.38923176102126267,
    0.1404757413020017,
    0.4624748345963122,
    0.40476078136560967,
    0.5493551981613517,
    0.7538194050691958,
    0.1072325578854757,
    0.8450791469905294,
    0.606750877582234,
    0.5371107322766333,
    0.09958405740246845,
    0.945034732857748,
    0.13047087517065137,
    0.2678229780245135,
    0.42951925457805284,
    0.36617091657929546,
    0.17297365741005655,
    0.5725635342334171,
    0.6944308937674721,
    0.36427282727138965,
    0.12359314055524107,
    0.5666675156341503,
    0.8762007535891587,
    0.14556421567749933,
    0.9020977218474983,
    0.43207921053673326,
    0.7520278750057254,
    0.338306191187851,
    0.6650243830024906,
    0.3762746789052943,
    0.2961209231848637,
    0.05285406494630662,
    0.8224770216025028,
    0.16404759805894775,
    0.8419732300672219,
    0.05351492332774721,
    0.7835726189649718,
    0.6901374489219438,
    0.3812513865738958,
    0.5443403475947189,
    0.7634609277765003,
    0.16888011765313826,
    0.22961608147173962,
    0.15735738583587955,
    0.6097669852564036,
    0.810012105960514,
    0.6695592988925657,
    0.05621189516147751,
    0.5580785697512738,
    0.039516081998267505,
    0.17203628432613316,
    0.6016259295884278,
    0.7005245478385356,
    0.7330914535267358,
    0.5662026788534701,
    0.7533517227290362,
    0.11452564990339853,
    0.05595253118160082,
    0.972152381925897,
    0.09318598199680628,
    0.7173138182625347,
    0.5733885808170838,
    0.32155276778475894,
    0.9695784383922547,
    0.5994620797542802,
    0.9224020871595191,
    0.35307729516411035,
    0.4752725728616548,
    0.10993185277072892,
    0.33794894782266593,
    0.5322685827600458,
    0.36138653412249266,
    0.7142104565637826,
    0.7683031177339334,
    0.46492470694498367,
    0.6993034278148852,
    0.8231196000279293,
    0.3461587530789376,
    0.8088036389346978,
    0.04668385288982091,
    0.09226747323869411,
    0.4332161677429446,
    0.9151203990008688,
    0.4446022347443669,
    0.5765406285635626,
    0.5223662232809351,
    0.4554338808830838,
    0.3319631358453653,
    0.9085663909023455,
    0.6542114616062018,
    0.8253470159349379,
    0.48289058507772753,
    0.7386461233495933,
    0.03301148158843692,
    0.07540240277812227,
    0.08715177400291974,
    0.22745715015052226,
    0.8991417020163615,
    0.34531841995496126,
    0.8798309647661797,
    0.9760576271205524,
    0.7632984112084872,
    0.9558043366681767,
    0.07737703416252018,
    0.47660299203442835,
    0.1911978430103929,
    0.279097730979292,
    0.17483823361713546,
    0.4738922957509982,
    0.8720059709244666,
    0.04723740084708006,
    0.9345486407752273,
    0.7864281883522835,
]

whiplash = Whiplash(
    API_URL,
    API_KEY,
)

collection = whiplash.get_collection("example")

assert collection is not None

print(collection)

start = time.time()
vectors = []
for i in range(1000):
    vector = Vector(
        f"id_{random.randint(100,99999999)}", [random.random() for _ in range(256)]
    )
    vectors.append(vector)
collection.insert_batch(vectors)
insert_time = (time.time() - start) / 100

print(f"Inserted {len(vectors)} vectors")
print(f"Average Insert time: {insert_time}")

start = time.time()
print(collection.search(query))

print("Search took", time.time() - start, "seconds")
